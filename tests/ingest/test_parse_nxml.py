"""
Test pubmed NXML parsing; verify expressions extract intended text
"""
import os

from lxml import etree
import pytest

from ingest import parse_nxml

# TODO: Add tests for x_article_authors and x_article_editors later

# TODO: improve figure captions and add handling

####
# Fixtures
####
@pytest.fixture(scope='module')
def sample_xml():
    here = os.path.dirname(__file__)
    parser = etree.XMLParser(remove_blank_text=True)
    return etree.parse(os.path.join(here, "fixtures/PMC3414848.nxml"), parser=parser)


@pytest.fixture
def article_meta(sample_xml):
    return parse_nxml.x_article_meta(sample_xml)[0]


####
# Tests
####
def test_x_journal(sample_xml):
    actual = parse_nxml.x_journal(sample_xml)
    expected = "Carbohydrate Polymers"
    assert len(actual) == 1
    assert actual[0] == expected


def test_x_article_title(article_meta):
    actual = parse_nxml.x_article_title(article_meta)
    expected = "S-protected thiolated chitosan: Synthesis and in vitro characterization"
    assert len(actual) == 1

    assert actual[0] == expected


def test_x_article_abstract(article_meta):
    actual = parse_nxml.x_article_abstract(article_meta)
    expected = 'Purpose of the present study was the generation and evaluation of novel thiolated chitosans,\n                    so-named S-protected thiolated chitosans as mucosal drug delivery systems. Stability of all\n                    conjugates concerning swelling and disintegration behavior as well as drug release was examined.\n                    Mucoadhesive properties were evaluated in vitro on intestinal mucosa. Different thiolated chitosans\n                    were generated displaying increasing amounts of attached free thiol groups on the polymer, whereby\n                    more than 50% of these thiol groups were linked with 6-mercaptonicotinamide. Based on the\n                    implementation of this hydrophobic residue, the swelling behavior was 2-fold decreased, whereas\n                    stability was essentially improved. Their mucoadhesive properties were 2- and 14-fold increased\n                    compared to corresponding thiolated and unmodified chitosans, respectively. Release studies out of\n                    matrix tablets comprising the novel conjugates revealed a controlled release of a model peptide.\n                 Accordingly, S-protected thiomers represent a promising type of mucoadhesive polymers for the\n                    development of various mucosal drug delivery systems.\n                '
    actual = ' '.join(actual)
    assert actual == expected


def test_x_article_keywords(article_meta):
    actual = parse_nxml.x_article_keywords(article_meta)
    expected = ['Thiomers', 'S-protected thiomers', 'Disulfide bond formation', 'Mucoadhesion', 'Stability']
    assert len(actual) == len(expected)
    assert actual == expected


def test_x_article_pmid(article_meta):
    actual = parse_nxml.x_article_pmid(article_meta)
    expected = '22839999'
    assert actual[0] == expected


def test_x_article_pmc(article_meta):
    actual = parse_nxml.x_article_pmc(article_meta)
    expected = '3414848'
    assert actual[0] == expected


def test_x_article_doi(article_meta):
    actual = parse_nxml.x_article_doi(article_meta)
    expected = '10.1016/j.carbpol.2012.05.028'
    assert actual[0] == expected


def test_x_body_text(sample_xml):
    actual = parse_nxml.x_body_text(sample_xml)
    actual = ' '.join(actual)
    expected = "1 Introduction As the uptake of most drugs from mucosal membranes is controlled by a passive diffusion process, it is\n                essential to provide a concentration gradient as steep as possible on the mucosa. In order to achieve\n                that goal, the delivery system has to be kept as long as possible in contact with the absorption\n                membrane, which can be guaranteed by mucoadhesive polymers. They can increase the intimate contact time\n                with mucus surfaces resulting in increased drug concentration at the site of absorption and\n                consequently improved overall bioavailability. In contrast to ‘conventional’ polymers,\n                which are quite insufficient in order to guarantee this effect and whose mucoadhesive properties are\n                only based on non-covalent bonds, thiolated polymers (thiomers) are capable of forming covalent bonds\n                with cysteine-rich subdomains of the mucus gel layer via disulfide exchange reactions ( Bernkop-Schnürch, Schwarz, & Steininger,\n                    1999 ). Mucoadhesive, permeation enhancing and efflux pump inhibitory properties of\n                poly(acrylic acid) and chitosan, were strongly improved by thiolation ( \n                    Bernkop-Schnürch, Hornof, & Zoidl, 2003; Marschütz & Bernkop-Schnürch,\n                    2002 ). Besides all these advantages, however, thiomers show comparatively low stability in\n                solutions, as they are subject of thiol oxidation at pH ≥6 unless sealed under inert conditions\n                ( Bernkop-Schnürch et al., 2003 ). This hindrance\n                limits their permeation enhancement and mucoadhesive features in body regions, where pH is raised. The\n                design and development of thiomers being stable in liquid and semisolid formulations would therefore be\n                highly advantageous, opening the door for numerous additional applications. According to this, it was\n                the aim of the present study to generate thiolated polymers, whose thiol groups are protected by\n                already formed disulfide bonds, which offer the advantage of not being subject of oxidation. The\n                hypothesis to achieve this goal is based on covalent chromatography, where, for instance, peptides and\n                proteins are very efficiently linked to thiol bearing resins, when they are preactivated via pyridyl\n                substructures ( Carlsson, Drevin, & Axén,\n                    1978; Norris & Brocklehurst, 1976 ). Pyridyl disulfides react very rapidly and\n                quantitatively with sulfhydryl groups over a broad pH range to form disulfide bonds. During this\n                reaction, a disulfide exchange occurs between the molecule's —SH group and the pyridyl thiol\n                group, i.e. the thiomer forms disulfide bonds with cysteine-rich subdomains of mucus glycoproteins with\n                the pyridyl thiol moiety as leaving group. The pyridyl thiol leaving group, however, is from the\n                toxicological point of view problematic. Utilizing nicotinamide (vitamin B3) instead of the pyridyl\n                group excludes such toxic effects. In order to apply this novel concept for thiolated chitosans, it was\n                the aim of this study to synthesize and characterize an S-protected thiolated chitosan regarding its\n                application in mucosal drug delivery systems.\n             2 Materials and methods 2.1 Materials Low viscous chitosan with an average molecular weight of 150\xa0kDa and a deacetylation degree\n                    of 85% was obtained from Sigma Aldrich, Austria. Dimethyl sulfoxide (DMSO), 5,5′-dithiobis(2-nitrobenzoic\n                    acid) (Ellman's Reagent), sodium borohydride (NaBH 4 ), hydrogen peroxide (H \n                        2 O 2 ), dialysis tubes (MW cutoff 12\xa0kDa), thioglycolic acid (TGA),\n                    thiourea, 6-chloronicotinamide, glutathione (GSH), 1-ethyl-3-(3-dimethylaminopropyl) carbodiimide\n                    hydrochloride (EDAC), porcine gastric mucin and MTT [3-(4,5-dimethylthiazol-2-yl)-2,5-diphenyl\n                    tetrazolium bromide] were purchased from Sigma Aldrich, Austria. Leuprolide was supplied from\n                    Bachem AG, Switzerland. Caco-2 cells were kindly donated by Prof. Pfaller, Institute of Physiology,\n                    Medical University of Innsbruck. All other chemicals were of analytical grade.\n                 2.2 Synthesis of thiolated and S-protected thiolated conjugates The synthesis of S-protected thiolated chitosan is a tow-step procedure. The first modification\n                    involved the covalent attachment of thioglycolic acid (TGA) to chitosan (CS) due to the formation\n                    of amide bonds between the primary amino groups of the polymer and carboxylic acid groups of TGA as\n                    described previously ( Kast & Bernkop-Schnürch,\n                        2001 ). For the second modification, the aromatic ligands 6-mercaptonicotinamide (6-MNA)\n                    as well as its dimer 6,6′-dithionicotinamide (6,6-DTNA), which are commercially not\n                    available, had to be synthesized according a method developed by  Forrest and\n                        Walker (1948) . The second modification step was then achieved by disulfide bond\n                    formation between free thiol groups of the thiolated chitosan and the aromatic ligand ( Fig. 1 ).\n                 2.3 Assessment of cytotoxic effects To evaluate potential cytotoxic effects of these S-protected thiolated chitosans, MTT assay was\n                    performed on a Caco-2 monolayer ( Mosmann, 1983 ). Cells\n                    were cultured on 24-well plates at a density of 1\xa0×\xa010 5 \xa0cells/ml\n                    in 500\xa0μl minimum essential medium (MEM) for 14 days at 37\xa0°C and\n                    5% CO 2 . Thereafter, cells were incubated with 0.5% (m/v) of S-protected thiomers,\n                    thiomers or unmodified chitosan control. Furthermore, nicotinamide (vitamin B 3 ) as well\n                    as the monomeric and dimeric reagent were tested for their influence on cell viability. Untreated\n                    cells served as positive control, whereas a 10% solution of Triton X-100 was used as negative\n                    control. After 3 and 24\xa0h of incubation at 37\xa0°C cells were washed with PBS\n                    and medium was replaced by 500\xa0μl of MTT assay. Cells were incubated for 3\xa0h\n                    along with MTT solution at 37\xa0°C. Absorbance of the dye was measured at a\n                    wavelength of 570\xa0nm. Cell viability was calculated as percentages of the positive control:\n                     Cell viability [ % ] = Average absorbance value of each triplicate positive control × 100 . \n                 2.4 Tablets manufacture For further studies all lyophilized S-protected thiomers, corresponding thiomers and unmodified\n                    chitosan were compressed by a single punch excentric press (Paul Weber, Remshalden-Grünbach,\n                    Germany) into 30\xa0mg, 5.0\xa0mm diameter flat-faced tablets. The compaction pressure of\n                    12\xa0kN was kept constant during the preparation of all tablets. At least three tablets of\n                    each polymer sample were checked for resistance to crushing according to the European\n                    Pharmacopoeia.\n                 2.5 Evaluation of the disintegration behavior For testing the disintegration behavior all conjugates were compressed into tablets as described\n                    above. Stability of each S-protected thiolated chitosan, corresponding thiomer and unmodified\n                    chitosan tablet was analyzed in 100\xa0mM HCl and 100\xa0mM phosphate buffer (pH 6.8) at\n                    37\xa0°C with a disintegration test apparatus according to the European Pharmacopoeia.\n                    The oscillating frequency was adjusted to 0.5\xa0s −1 . Time was recorded\n                    when tablets were completely disintegrated.\n                 2.6 Evaluation of the water-uptake capacity The water-absorbing capacity was determined by a gravimetric method. In brief, S-protected thiomer,\n                    corresponding thiomer and unmodified control tablets were fixed to a needle and immersed in a\n                    beaker containing phosphate buffer (pH 6.8) at 37\xa0°C. At pre-determined time points\n                    the swollen tablets were taken out of the incubation medium, excess water was removed and the\n                    amount of water uptake determined gravimetrically. The absorbed amount was calculated according to\n                    the following equation: Water uptake (%)\xa0=\xa0[(\n                     W \n                     t \n                    \xa0−\xa0\n                     W \n                     0 )/\n                     W \n                     0 ]\xa0×\xa0100%, where\n                     W \n                     t \n                    is the disc weight at a given time point and\n                     W \n                     0 \n                    the initial weight of the disc. Water uptake was investigated as a function of time.\n                 2.7 In vitro release studies Release studies were carried out with unmodified chitosan, thiolated and S-protected thiolated\n                    tablets and the model peptide drug leuprolide. First, 27\xa0mg of each polymer were suspended\n                    in demineralised water, homogenized with 3\xa0mg of leuprolide dissolved in water and stirred\n                    for 1\xa0h. Thereafter, mixtures were lyophilized and compressed into tablets as described\n                    above. The release rate of leuprolide out of each tablet was analyzed in 50\xa0ml tubes\n                    containing 20\xa0ml of 100\xa0mM phosphate buffer, pH 6.8. Vessels were closed, placed on\n                    an oscillating waterbath and incubated at 37\xa0°C. Samples of 500\xa0μl\n                    were withdrawn at pre-determined time points and replaced with an equal volume of release medium\n                    equilibrated at 37\xa0°C. Sink conditions were maintained throughout the study.\n                    Samples were analyzed using HPLC according to a method previously described by  \n                        Guo et al. (2004) . Concentrations were quantified from integrated peak areas and\n                    calculated by interpolation from an according standard curve containing increasing concentrations\n                    of leuprolide. Cumulative corrections were made for previously removed samples.\n                 2.8 In vitro evaluation of mucoadhesive properties 2.8.1 Studies via rotating cylinder In order to evaluate the binding of tablets to the intestinal mucosa, mucoadhesion was tested\n                        using “Paddle Apparatus” according to the European Pharmacopeia. An Erweka DT\n                        700 (Erweka GmbH, Heusenstamm, Germany) dissolution tester was used. Vessels were filled with\n                        900\xa0ml of 100\xa0mM phosphate buffer (pH 6.8) at 37\xa0°C and\n                        rotational speed was set to 200\xa0rpm for all tests. Polymer tablets were prepared as\n                        described above and attached to a native small intestinal porcine mucosa, which has been fixed\n                        to stainless steel cylinders used as stirrers. Detachment of test tablets was determined\n                        visually and monitored with a webcam over 5 days time period ( \n                            Bernkop-Schnürch & Steininger, 2000 ).\n                     2.8.2 Rheological investigations of polymer/mucin mixtures First, mucin stock solution (10%, m/v) was prepared and stored at 4\xa0°C for a\n                        maximum of 24\xa0h. Polymers were hydrated in phosphate buffer pH 6.8 to a final\n                        concentration of 2% (m/v). Each conjugate solution was added to an equal volume of mucin stock\n                        solution and mixed. Immediately after suspending in buffer and an equilibration period of 60\xa0min\n                        at 37\xa0°C, 500\xa0μl of polymer/mucin mixtures were transferred to\n                        a plate–plate viscometer (RotoVisco RT20, Haake GmbH, Karlsruhe, Germany). Solutions\n                        containing either 1% (m/v) unmodified, thiolated and S-protected polymers or 5% (m/v) mucin\n                        powder were used as references. For all samples the apparent viscosity ( \n                            η ) was measured immediately after equilibration. The shear stress was set\n                        at a range of 0.5–500\xa0Pa and the gap between two plates was 0.5\xa0mm.\n                     2.9 Statistical data analysis GraphPad Prism 5 was used to calculate the mean values of all samples. Unpaired student's  \n                    t -test was performed to test the significance of the difference between the mean value of\n                    the control and the respective sample. When comparisons of more than two mean values were made, the\n                    data were analyzed with one way ANOVA. Level of  p \xa0≤\xa00.05\n                    was set for significant,  p \xa0≤\xa00.01 for very significant and  \n                        p \xa0≤\xa00.001 for highly significant.\n                 3 Results and discussion 3.1 Characterization of the thiolated chitosans Mediated by the carbodiimide EDAC and increasing amounts of activated TGA ( \n                    Table 1 ) added to the polymer, three different thiolated chitosans with raising degrees of\n                    conjugated thiol groups could be received. The degree of modification was determined by quantifying\n                    the total amount of thiol groups, which is a composition of free and oxidized thiol groups in form\n                    of disulfide bonds. The amount of free thiol groups was determined photometrically with Ellman's\n                    reagent. Absorbance was measured at a wavelength of 450\xa0nm with a microplate reader\n                    (FluoStar Galaxy, BMG Offenburg, Germany). A calibration curve of TGA was used to calculate the\n                    amount of free thiol groups immobilized on the polymer. To determine the degree of disulfide bonds,\n                    the reaction with Ellman's reagent was performed after reducing disulfides with NaBH 4 .\n                    Measurement of absorbance and quantification of the total amount of thiol groups was performed as\n                    described above.\n                 As illustrated in  Table 1 , the amount of free thiol\n                    groups attached to the polymer was determined to be 340, 660 and 980\xa0μmol thiol\n                    groups per gram polymer. A control prepared in the same way as the chitosan–TGA conjugates\n                    but with the carbodiimide omitted during the coupling reaction, displayed only a negligible amount\n                    of remaining traces of TGA. All lyophilized thiolated polymers were white, of fibrous structure and\n                    partly water soluble.\n                 3.2 Characterization of the aromatic ligands The monomer 6-mercaptonicotinamide could be obtained as fine yellow powder. The dimer 6,6′-dithionicotinamide\n                    was generated due to the addition of a H 2 O 2  solution to the monomer and could\n                    be received as fine white powder. Both reagents exhibit solubility in DMSO, but not at all in water\n                    or any convenient solvent. To control all further reactions, both aromatic reagents were analyzed\n                    by an UV-spectrometer (UV-mini1240, Shimadzu Co., Japan). 6,6′-DTNA showed a significant\n                    peak at 297\xa0nm and a minor one at 253\xa0nm. 6-MNA, however, displayed a well\n                    pronounced peak at 307\xa0nm. In addition, DSC-thermograms were recorded with a DSC 7 system\n                    (Perkin-Elmer, Norwalk, USA) using the Pyris 2.0 software. Samples were scanned at a speed of 10\xa0°C/min\n                    in a 30–270\xa0°C temperature range. The monomer 6-MNA showed a melting point\n                    at around 264\xa0°C which is in good correlation with literature values (266–268\xa0°C)\n                    ( Forrest & Walker, 1948 ).\n                 3.3 Characterization of the S-protected thiolated chitosans Disulfide bond formation between thiol groups of each thiomer (CS-TGA-340, CS-TGA-660, CS-TGA-980)\n                    and the aromatic ligand was achieved as illustrated in  Fig.\n                        1 . The pyridyl substructure was thus covalently linked to the thiomer where it can be\n                    subsequently released by addition of reducing agents or compounds containing thiol groups. For\n                    determining the amount of conjugated aromatic ligand, reduced glutathione (0.1%, m/v) was added to\n                    each polymer solution (0.1%, m/v) for release of 6-MNA, which in turn can be quantified\n                    photometrically at 307\xa0nm according to previous analyses. Calculations were done by\n                    interpolation from a standard curve obtained with increasing amounts of 6-MNA. The amount of\n                    disulfide bonds and remaining free thiol groups fixed on the conjugates was determined with\n                    Ellman's reagent as described above. The resulting S-protected thiomers (TGA-MNA-340, TGA-MNA-660,\n                    TGA-MNA-980) displayed 170, 400 and 690\xa0μmol of covalently attached 6-MNA per gram\n                    thiomer. Samples without addition of GSH displayed only a negligible amount of 6-MNA. All\n                    lyophilized conjugates were white, of fibrous structure and low water soluble. Solubility in\n                    aqueous solutions decreased by a higher amount of conjugated 6-MNA, which might be based on the\n                    hydrophobic character and higher content of disulfide bonds.\n                 The coupling reaction was on the one hand carried out by use of the monomer 6-MNA with an oxygen\n                    donating compound (H 2 O 2 ) and on the other hand by use of its dimer 6,6′-DTNA\n                    through cleavage of the disulfide bond to give 6-MNA. For reaction with 6-MNA, it is assumed that\n                    thiol groups convert into their deprotonated form thiolate anions (RS − ) or\n                    activated thiol groups at low pH values by hydrogen peroxide. Nucleophilic attack of an activated\n                    thiol group can lead to a disulfide bond with another thiol group ( Barrett et\n                        al., 1999 ). The dimeric reagent, however, reacted with the thiomer to form a mixed\n                    disulfide under release of 6-MNA. In this reaction way, additional oxidizing agents were not\n                    necessary, whereby the risk of oxidation between molecules in solution was minimized. In addition,\n                    coupling through reaction with dimer was at least 2-fold higher compared to reaction with monomer.\n                    The best molar ratio of thiol groups on the thiomer and aromatic ligand was found to be 1:2 with a\n                    coupling rate of more than 50%. Higher ratios generated immediate precipitations of the aromatic\n                    ligand owing to an insufficient amount of DMSO in the reaction mixture with each thiomer. The\n                    dissolution of hydrophilic thiomer on the one hand and hydrophobic ligand on the other hand in the\n                    same medium was a major obstacle. Due to the insolubility and precipitation of 6-MNA in aqueous\n                    solutions, the thiomer had to be dissolved in a mixture of DMSO and water, whereby the ratio has to\n                    be shifted to the side of DMSO. Consequently, the best ratio found for DMSO/water mixture was 7:3.\n                    Syntheses with monomer were done at pH 7–8, due to the oxidation process with H 2 O \n                        2 . For reactions with dimer, several pH values were tested. Syntheses at a pH value of\n                    around 6 resulted in the highest coupling rate. Due to the photometric control (297 and 307\xa0nm)\n                    every 2\xa0h, all reactions were found to be completed after 6\xa0h. Extension the\n                    reaction time up to 24\xa0h had no significant effect on the coupling rate.  Table 2\n                      displays the coupling amount of the aromatic ligand having been added as monomeric or\n                    dimeric reagent.\n                 To ensure the coupling between thiomer and aromatic ligand, FT-IR studies of CS-TGA-980 and\n                    corresponding S-protected thiomer (TGA-MNA-980) were conducted (data not shown). A characteristic\n                    band at 3030\xa0cm −1  is pointed out to an aromatic (—C—H)\n                    stretching vibration, which was detectable in the infrared spectrum of the S-protected thiolated\n                    chitosan. The S-protected thiomer showed also broad peaks between 1650 and 1450\xa0cm \n                        −1\n                      as —C\n                     \n                            000000000000\n                            000000000000\n                            000000000000\n                            111111111111\n                            000000000000\n                            111111111111\n                            000000000000\n                            000000000000\n                            000000000000\n                         \n                    C stretching vibration, usually four bands of various intensity, which confirmed as well the\n                    presence of the aromatic compound. Furthermore, an absorption peak at 800\xa0cm \n                        −1\n                      could be assigned to a —C—H deformation vibration of a 1,4-substituted\n                    aromatic compound such as 6-MNA. These results indicate that coupling between 6-MNA and thiomer\n                    took place.\n                 Besides the preparation and characterization of these novel conjugates, biodegradation stays also in\n                    the foreground. Our research group examined the biodegradability of aromatic thiomers in contrast\n                    to aliphatic thiomers by lysozyme. They found out that aromatic thiomers were degraded in a higher\n                    and faster way than aliphatic thiomers (Laffleur et al., 2012, unpublished results). With regard to\n                    thiomers with disulfide bonds,  Groll, Singh, Albrecht, and\n                        Moeller (2009)\n                      proved that disulfide cross-linkages can be cleaved in the presence of glutathione under\n                    physiological conditions. Furthermore, in previous studies the biodegradation of CS-TGA was\n                    investigated and it could be shown that the thiomer degraded under physiological conditions by\n                    addition of lysozyme ( Kast & Bernkop-Schnürch,\n                        2001 ).\n                 3.4 Assessment of cytotoxic effects Cell viability test was performed by MTT assay after a 3 and 24\xa0h exposure to all compounds.\n                    There were no significant differences ( p \xa0>\xa00.05) in the\n                    percentage of cell viability after an incubation of 3 or 24\xa0h. Furthermore, neither the\n                    monomeric nor the dimeric reagent induced severe toxicity with more than 88% of viable cells after\n                    24\xa0h. Quantitative assessment of viable cells after 24\xa0h contact with S-protected\n                    thiomers showed at least 83% mitochondrial activity indicating a likely non-toxic nature of this\n                    class of thiolated polymers. In case of all thiomers, viability of cells deceased to approximately\n                    77% after 24\xa0h of incubation. A reason for this reduction might be the increase in\n                    viscosity of all thiomers due to an intramolecular disulfide bond formation, which cannot take\n                    place in the same extent in case of the already oxidized S-protected thiomers. Rheological\n                    investigations approved this viscosity increase after 60\xa0min incubation at 37\xa0°C\n                    as shown in  Table 3 , whereas this effect was much more\n                    pronounced after a period of 24\xa0h (Dünnhaupt et al., unpublished results).\n                    Accordingly, all S-protected chitosans were found less toxic than their corresponding thiomers as\n                    shown in  Fig. 2 .\n                 3.5 Evaluation of the disintegration behavior The disintegration behavior of thiolated and S-protected polymers compressed into tablets is a good\n                    indicator for their mucoadhesive and cohesive features. Disintegration was first tested in 0.1\xa0M\n                    HCl for 2\xa0h, revealing the stability of this new class of protected thiomers towards acetic\n                    conditions. Unmodified chitosan tablets disintegrate in about 10\xa0min, thiomer tablets\n                    dissolved after maximum 50\xa0min and S-protected thiomer tablets were stable for a period of\n                    2\xa0h, representing a 12-fold increased stability compared to unmodified tablets. To induce a\n                    disintegration of these S-protected tablets, studies were continued in phosphate buffer pH 6.8\n                    containing 5\xa0mM reduced glutathione. GSH was able to reduce the disulfide bonds inside the\n                    polymer, whereby tablets were disintegrated after 9\xa0h incubation. These results revealed a\n                    much higher stability towards acetic conditions of test discs based on S-protected thiolated\n                    chitosan in comparison to their corresponding thiomers and unmodified control as shown in  Fig. 3 .\n                 Additionally, hardness of all tablets was checked for resistance to crushing. Results were in good\n                    agreement with outcomes of disintegration and water uptake studies and revealed that CS tablets\n                    exhibit with 30\xa0N the lowest cohesiveness. Hardness of tablets increased with raising\n                    degree of cross-linking. Hence, TGA-MNA-980 tablets displayed with 175\xa0N the highest\n                    stability, followed by TGA-MNA-660 with 160\xa0N, TGA-MNA-340 with 140\xa0N, CS-TGA-980\n                    with 135\xa0N, CS-TGA-660 with 115\xa0N and CS-TGA-340 with 105\xa0N. The observed\n                    higher cohesiveness of S-protected tablets can be explained by their higher amount of cross-linked\n                    disulfide bonds within the polymeric network. However, both modification steps (thiolation and\n                    S-protection) stabilized the tablets compared to the unmodified ones. Overall, disulfide bonds are\n                    an integral part of the structure of polymers containing thiol groups and contribute to enhanced\n                    stability and cohesiveness ( Bernkop-Schnürch &\n                        Steininger, 2000 ).\n                 3.6 Evaluation of the swelling behavior Swelling behavior of matrix tablets has a great impact on their adhesive and cohesive properties,\n                    drug release and stability. Results revealed that tablets of unmodified CS swelled more rapid in\n                    the beginning than thiolated and S-protected ones, because of their stronger hydrophilic character\n                    and higher number of charges on the polymer. After 2\xa0h, a gradual decrease in the tablet\n                    weight of unmodified CS was observed related to a slow erosion process within the following hours\n                    of the experiment. This observation might be explained by the low cohesiveness of CS tablets and\n                    the impossibility of cross-linking within the polymer backbone. Furthermore, results demonstrated\n                    that the covalent attachment of TGA to CS has a significant influence ( p \xa0<\xa00.05)\n                    on the swelling behavior of the polymer. The weight of each thiolated tablet increased rapidly\n                    after 1\xa0h, steadily over the following 5\xa0h and remained almost constant between 6\n                    and 12\xa0h of the experiment. Additionally, it could be shown that the higher are the amount\n                    of conjugated thiol groups, the higher was the water absorption capacity. Tablets comprising\n                    CS-TGA-980, for example, reached a maximum weight of 178\xa0mg after 12\xa0h,\n                    representing a 6-fold increase of the initial weight compared to CS-TGA-340 with just a 3.7-fold\n                    rise. An explanation for this effect is given by the higher amount of free and connected thiol\n                    groups in case of CS-TGA-980 ( Kafedjiiski, Krauland, Hoffer,\n                        & Bernkop-Schnürch, 2005 ). However, due to this cross-linking process,\n                    tablets can absorb water in quantities which are multiples of their own weight and can fixate them\n                    firmly within their polymer networks. In contrast, the incorporation of an aromatic ligand on the\n                    thiomer backbone reduced the swelling behavior of all S-protected tablets. TGA-MNA-980 tablets, for\n                    instance, gained a maximum weight of 105\xa0mg after 12\xa0h incubation, which is more\n                    than 40% lower than that of CS-TGA-980 tablets. In addition, it could be shown that water uptake\n                    for all S-protected tablets depends on the amount of covalently attached 6-MNA and remaining free\n                    thiol groups. Due to a pronounced hydrophobic character, it took longer until water could penetrate\n                    inside the tablet and intramolecular disulfide bond formation of remaining free thiol groups took\n                    place. Consequently, the amount of covalently attached aromatic ligand as well as remaining free\n                    thiol groups on the S-protected tablet are responsible for a slower swelling in the beginning\n                    following an increased water uptake once water began to penetrate into the tablet. Nevertheless,  Mortazavi and Smart (1994a)\n                      pointed out that a low swelling behavior can be advantageous for prolonged mucoadhesion.\n                    Mucoadhesive materials need to take up water from the underlying mucosal tissues by absorbing,\n                    swelling and capillary effects leading to a considerably stronger adhesion. However, excessive\n                    water uptake will lead to overhydration forming slippery mucilage and result in less adhesiveness ( Duchêne & Ponchel, 1992 ). Hence, the\n                    slow swelling of S-protected thiomers might be advantageous to avoid overmuch hydration and loss of\n                    adhesiveness. Results of the water uptake studies are presented in  Fig.\n                        4 (a).\n                 3.7 In vitro release studies Release studies were carried out with the peptide drug leuprolide from unmodified chitosan,\n                    CS-TGA-660 and TGA-MNA-660 tablets. S-protected tablets showed a significantly ( p \xa0<\xa00.05)\n                    slower release of the hydrophilic peptide drug in comparison to their corresponding thiolated and\n                    unmodified chitosan tablets. Within 6\xa0h, for instance, already 100% of leuprolide were\n                    released out of the chitosan tablet in comparison to 80% for the thiolated and 72% for the\n                    S-protected tablet. The fast swelling of the unmodified tablet might be the reason for a fast\n                    release of the drug within the first 2\xa0h followed by a slower but still increasing release\n                    over the last 4\xa0h. Their strong swelling behavior might be the reason for a rapid\n                    penetration of the matrix tablets and consequently faster release of the drug. Furthermore, due to\n                    the slow erosion process of the chitosan tablets as described above, the peptide could be easily\n                    released. Owing to the higher cohesiveness and lower swelling behavior of the S-protected tablets\n                    release kinetics of the drug were affected and a sustained release could be received, whereby a\n                    prolonged therapeutic level of drugs exhibiting a short elimination half-live can be maintained.\n                    Consequently, the frequency of dosing could be reduced contributing to an improved compliance.\n                    Results of the in vitro release studies are outlined in  Fig.\n                        4 (b).\n                 3.8 In vitro evaluation of mucoadhesive properties 3.8.1 Mucoadhesion studies via rotating cylinder Mucoadhesive properties of the S-protected thiolated chitosans were on the one hand tested by\n                        rotating cylinder method. This method is supposed to simulate an in vivo situation, as it\n                        imitates the adhesion and cohesiveness of the polymer in physiological medium. Unmodified\n                        chitosan tablets detached from the intestinal mucosa or solved within 10\xa0h, while\n                        thiolated and S-protected tablets remained attached for at least 32\xa0h (CS-TGA-340) and\n                        50\xa0h (TGA-MNA-340) demonstrating at least 3.2- and 5-fold improved mucoadhesive\n                        properties. This effect was more pronounced for MNA-660 tablets, which were adhesive on the\n                        mucosa for at least 90\xa0h, resulting in a 2-fold improvement compared to their\n                        corresponding thiomer tablets (CS-TGA-660) and 9-fold to unmodified chitosan tablets. Compared\n                        with previous studies, chitosan-4-butylamidine for example with 240\xa0μmol/g\n                        thiol groups remained on the mucosa for more than 161\xa0h ( \n                            Grabovac, Guggi, & Bernkop-Schnürch, 2005 ). In this study, however,\n                        the fully immersed cylinder was agitated with 125\xa0rpm only, whereas the rotational\n                        speed in the present study was set to 200\xa0rpm and the experiment was stopped after 120\xa0h.\n                        Nevertheless, neither the highest thiolated tablet (CS-TGA-980) nor the corresponding\n                        S-protected tablet (TGA-MNA-980) were detached after this period, demonstrating the\n                        effectiveness of this class of thiomers and placing them among the most mucoadhesive polymers\n                        to our notice ( Grabovac et al., 2005 ). Outcomes of\n                        this study are shown in  Fig. 5 .\n                     3.8.2 Rheological investigation of polymer/mucin mixtures Within this study, oscillatory measurements were performed within the linear viscoelasticity\n                        region. Results provide information about dynamic properties of each thiomer solution (1%, m/v)\n                        as well as mixtures of these polymers with 5% (m/v) mucin gel. In order to receive reproducible\n                        results, rheological studies were performed with commercially available mucin instead of native\n                        mucus as described by  Rossi, Bonferoni, Ferrari, Bertoni,\n                            and Caramella (1996) . Results of this study concerning apparent viscosity values are\n                        shown in  Table 3  and in accordance with findings of\n                        the previous mucoadhesion studies. Due to the addition of TGA to chitosan dynamic viscosity of\n                        all thiomers increased during 60\xa0min incubation at 37\xa0°C by at least\n                        1.4-fold. In contrast, no significant change ( p \xa0>\xa00.05)\n                        in viscosity of chitosan as well as the S-protected thiomers could be detected after this\n                        period. Situation was altered when samples were mixed with mucin gel. Apparent viscosity values\n                        of CS-TGA-340, CS-TGA-660 and CS-TGA-980 showed a 2.3-, 2.7- and 4.6-fold increase compared to\n                        thiomers without mucin gel. In case of TGA-MNA-340, TGA-MNA-660 and TGA-MNA-980 viscosity\n                        increased by 2.7-, 4.2- and 4.7-fold when mucin was added to each sample. Strong mucoadhesive\n                        properties of delivery systems can induce a considerable change in rheological properties of\n                        the mucus layer ( Mortazavi & Smart, 1994b ).\n                        Moreover, it has been reported that an increase in viscosity of mucus/polymer interface\n                        directly correlates with the mucoadhesive properties of the polymer ( \n                            Smart, 2005 ). Results of rheological investigations implemented with thiomer and\n                        S-protected thiomer/mucin mixtures provide a strong support for this theory.\n                     Mucoadhesion is a complex phenomenon which can be influenced by numerous physiochemical\n                        conditions such as electrostatic forces. Positively charged CS however, interact with\n                        negatively charged mucin through non-covalent bonds providing therefore relative weak\n                        mucoadhesion in contrast to thiolated polymers ( Woodley,\n                            2001 ). Based on their free thiol groups, thiomers possess the ability to form\n                        covalent bonds with cysteine-rich subdomains of glycoproteins in the mucus layer. This process\n                        can occur either by oxidative coupling of thiol groups and/or by thiol-disulfide exchange\n                        reaction of the groups present in both polymer and mucus ( Leitner,\n                            Walker, & Bernkop-Schnürch, 2003; Perez-Vilar & Mabolo, 2007 ).\n                        While thiomers mainly react with disulfide bonds within the mucus, S-protected thiomers\n                        interact very rapidly and quantitatively over a broad pH range by thiol disulfide exchange\n                        reaction through cysteine subunits within the mucus to form disulfide bonds. During this\n                        reaction, a disulfide exchange occurs between the molecules —SH group and the pyridyl\n                        thiol group, i.e. the S-protected thiomer forms disulfide bonds with cysteine-rich subdomains\n                        of the mucus, whereby the pyridyl thiol moiety results as leaving group. Furthermore, as\n                        determined by  Barthelmes, Perera, Hombach, Dünnhaupt,\n                            and Bernkop-Schnürch (2011) , the average content of free thiol groups within\n                        the mucus layer is almost twice as high as the content of disulfide bonds. According to these\n                        outcomes, enhanced bonding between mucus and S-protected polymers can take place in contrast to\n                        mucus/thiomer conjugation. In addition, the protection of thiol groups can prevent an early\n                        oxidation before coming into contact with the mucus layer, whereby more active thiol groups are\n                        available for a long time intimate contact with mucosal membranes. Thus, S-protected thiolated\n                        chitosan could facilitate the oral uptake of several drugs by its strong mucoadhesive\n                        properties.\n                     4 Conclusion Within this study, a stable mucoadhesive chitosan, described as S-protected thiolated chitosan, has been\n                synthesized and characterized in terms of mucoadhesion, swelling and disintegration behavior,\n                controlled release and cytotoxic effects for the first time. The polymer was tested for its potential\n                as novel pharmaceutical excipient. In vitro mucoadhesion studies revealed promising results and place\n                this type of thiolated chitosan among the most effective mucoadhesive polymers. Furthermore, due to the\n                chemical modification of thiolated chitosan, water-uptake capacity as well as cytotoxicity could be\n                decreased, while cohesive properties were strongly improved. Hence, the implementation of thiolated\n                pyridyl substructures on this thiolated backbone resulted in conjugates displaying improved\n                mucoadhesive and cohesive properties. S-protected thiolated chitosan represents a stable and promising\n                tool for the development of various mucoadhesive drug delivery systems. Overall, this novel class of\n                thiolated chitosans containing protected thiol groups, offer the advantage of not being subject to any\n                oxidation at all, which opens the door for numerous additional applications.\n            "
    assert actual == expected


def test_x_acknowledgments(sample_xml):
    actual = parse_nxml.x_acknowledgements(sample_xml)
    actual = ' '.join(actual)
    expected = 'The work was supported by the  ,\n                vice-chancellorship for research (PhD grant, ID: 2010/3/Chem3) and the   (Fonds zur Förderung der wissenschaftlichen Forschung) project No. ZFP\n                235150.\n            '
    assert actual == expected
